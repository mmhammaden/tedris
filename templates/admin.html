{% extends "base.html" %}

{% block title %}لوحة الإدارة - منصة تدريس{% endblock %}

{% block content %}
<div class="fade-in">
     Admin Header 
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl text-white p-8 mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold mb-2">
                    <i class="fas fa-users-cog ml-2"></i>
                    لوحة الإدارة
                </h1>
                <p class="text-purple-100 text-lg">
                    إدارة المستخدمين والإحصائيات العامة للمنصة
                </p>
            </div>
            <div class="hidden md:block">
                <div class="bg-white bg-opacity-20 rounded-full p-4">
                    <i class="fas fa-chart-line text-4xl"></i>
                </div>
            </div>
        </div>
    </div>
    
     Statistics Cards 
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">إجمالي المستخدمين</p>
                    <p class="text-3xl font-bold text-gray-900">{{ stats.total_users }}</p>
                </div>
                <div class="bg-blue-100 rounded-full p-3">
                    <i class="fas fa-users text-2xl text-blue-600"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">تسجيلات جديدة</p>
                    <p class="text-3xl font-bold text-gray-900">{{ stats.recent_registrations }}</p>
                </div>
                <div class="bg-green-100 rounded-full p-3">
                    <i class="fas fa-user-plus text-2xl text-green-600"></i>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">آخر 7 أيام</p>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">المعلمين</p>
                    <p class="text-3xl font-bold text-gray-900">{{ stats.categories.get('teacher', 0) }}</p>
                </div>
                <div class="bg-purple-100 rounded-full p-3">
                    <i class="fas fa-chalkboard-teacher text-2xl text-purple-600"></i>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600">الطلاب</p>
                    <p class="text-3xl font-bold text-gray-900">{{ stats.categories.get('student', 0) }}</p>
                </div>
                <div class="bg-orange-100 rounded-full p-3">
                    <i class="fas fa-user-graduate text-2xl text-orange-600"></i>
                </div>
            </div>
        </div>
    </div>
    
     Charts and Users Table 
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
         Users Table 
        <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-table ml-2 text-primary-600"></i>
                        المستخدمون المسجلون
                    </h2>
                    <div class="flex space-x-2 space-x-reverse">
                        <button class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-download ml-2"></i>
                            تصدير
                        </button>
                        <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-filter ml-2"></i>
                            فلترة
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-right py-3 px-4 font-medium text-gray-700">الاسم</th>
                                <th class="text-right py-3 px-4 font-medium text-gray-700">الهاتف</th>
                                <th class="text-right py-3 px-4 font-medium text-gray-700">الفئة</th>
                                <th class="text-right py-3 px-4 font-medium text-gray-700">الولاية</th>
                                <th class="text-right py-3 px-4 font-medium text-gray-700">تاريخ التسجيل</th>
                                <th class="text-right py-3 px-4 font-medium text-gray-700">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr class="border-b border-gray-100 hover:bg-gray-50">
                                <td class="py-3 px-4">
                                    <div class="flex items-center">
                                        <div class="bg-primary-100 rounded-full w-8 h-8 flex items-center justify-center ml-3">
                                            <i class="fas fa-user text-primary-600 text-xs"></i>
                                        </div>
                                        <span class="font-medium">{{ user.full_name }}</span>
                                    </div>
                                </td>
                                <td class="py-3 px-4 text-gray-600">{{ user.phone }}</td>
                                <td class="py-3 px-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                        {% if user.user_category == 'teacher' %}bg-purple-100 text-purple-800
                                        {% elif user.user_category == 'student' %}bg-blue-100 text-blue-800
                                        {% elif user.user_category == 'admin' %}bg-green-100 text-green-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                        {{ user.user_category }}
                                    </span>
                                </td>
                                <td class="py-3 px-4 text-gray-600">{{ user.wilaya }}</td>
                                <td class="py-3 px-4 text-gray-600">{{ user.created_at[:10] }}</td>
                                <td class="py-3 px-4">
                                    <div class="flex space-x-2 space-x-reverse">
                                        <button class="text-blue-600 hover:text-blue-800 text-xs">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="text-green-600 hover:text-green-800 text-xs">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800 text-xs">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if users|length == 0 %}
                <div class="text-center py-8">
                    <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">لا توجد بيانات مستخدمين</p>
                </div>
                {% endif %}
            </div>
        </div>
        
         Statistics Panel 
        <div class="space-y-6">
             Category Distribution 
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">
                    <i class="fas fa-chart-pie ml-2 text-primary-600"></i>
                    توزيع المستخدمين
                </h3>
                <div class="space-y-3">
                    {% for category, count in stats.categories.items() %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full ml-2
                                {% if category == 'teacher' %}bg-purple-500
                                {% elif category == 'student' %}bg-blue-500
                                {% elif category == 'admin' %}bg-green-500
                                {% else %}bg-gray-500{% endif %}"></div>
                            <span class="text-sm text-gray-600">{{ category }}</span>
                        </div>
                        <span class="font-medium">{{ count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
             Quick Actions 
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">
                    <i class="fas fa-bolt ml-2 text-primary-600"></i>
                    إجراءات سريعة
                </h3>
                <div class="space-y-3">
                    <button class="w-full flex items-center p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors text-right">
                        <i class="fas fa-user-plus text-blue-600 ml-3"></i>
                        <span class="text-sm font-medium">إضافة مستخدم جديد</span>
                    </button>
                    
                    <button class="w-full flex items-center p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors text-right">
                        <i class="fas fa-download text-green-600 ml-3"></i>
                        <span class="text-sm font-medium">تصدير البيانات</span>
                    </button>
                    
                    <button class="w-full flex items-center p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors text-right">
                        <i class="fas fa-chart-bar text-purple-600 ml-3"></i>
                        <span class="text-sm font-medium">عرض التقارير</span>
                    </button>
                    
                    <button class="w-full flex items-center p-3 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors text-right">
                        <i class="fas fa-cog text-orange-600 ml-3"></i>
                        <span class="text-sm font-medium">إعدادات النظام</span>
                    </button>
                </div>
            </div>
            
             System Info 
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">
                    <i class="fas fa-info-circle ml-2 text-primary-600"></i>
                    معلومات النظام
                </h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">الإصدار:</span>
                        <span class="font-medium">1.0.0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">آخر تحديث:</span>
                        <span class="font-medium">اليوم</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">حالة الخادم:</span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            <i class="fas fa-circle text-xs ml-1"></i>
                            متاح
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function adminPage() {
    return {
        language: 'ar',
        text: {
            ar: {
                title: 'لوحة تحكم المدير',
                subtitle: 'إدارة المستخدمين ومراقبة النظام',
                totalUsers: 'إجمالي المستخدمين',
                recentRegistrations: 'التسجيلات الأخيرة (7 أيام)',
                teachers: 'المعلمون',
                students: 'الطلاب',
                allUsers: 'جميع المستخدمين',
                export: 'تصدير البيانات',
                logout: 'تسجيل الخروج',
                phone: 'الهاتف',
                name: 'الاسم الكامل',
                category: 'الفئة',
                role: 'الدور',
                wilaya: 'الولاية',
                school: 'المدرسة',
                registrationDate: 'تاريخ التسجيل'
            },
            fr: {
                title: 'Tableau de bord Admin',
                subtitle: 'Gestion des utilisateurs et surveillance du système',
                totalUsers: 'Total des utilisateurs',
                recentRegistrations: 'Inscriptions récentes (7 jours)',
                teachers: 'Enseignants',
                students: 'Étudiants',
                allUsers: 'Tous les utilisateurs',
                export: 'Exporter les données',
                logout: 'Se déconnecter',
                phone: 'Téléphone',
                name: 'Nom complet',
                category: 'Catégorie',
                role: 'Rôle',
                wilaya: 'Wilaya',
                school: 'École',
                registrationDate: 'Date d\'inscription'
            }
        },
        
        exportData() {
            // Create CSV content
            const headers = ['Phone', 'NNI', 'Matricule', 'Full Name', 'Category', 'Role', 'Wilaya', 'Moughataa', 'School', 'Registration Date'];
            const csvContent = [
                headers.join(','),
                // Add user data rows here - would need to be passed from backend
            ].join('\n');
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tedris-users-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Animate statistics
    const statNumbers = document.querySelectorAll('.text-3xl.font-bold');
    statNumbers.forEach(stat => {
        const finalValue = parseInt(stat.textContent);
        if (!isNaN(finalValue)) {
            let currentValue = 0;
            const increment = Math.ceil(finalValue / 30);
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    stat.textContent = finalValue;
                    clearInterval(timer);
                } else {
                    stat.textContent = currentValue;
                }
            }, 50);
        }
    });
    
    // Add table row hover effects
    const tableRows = document.querySelectorAll('tbody tr');
    tableRows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f9fafb';
            this.style.transform = 'scale(1.01)';
            this.style.transition = 'all 0.2s ease';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
            this.style.transform = 'scale(1)';
        });
    });
});
</script>
{% endblock %}
